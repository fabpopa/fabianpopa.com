<!DOCTYPE html>
<style>
  * { margin: 0; padding: 0; }
  html { background: black; }
</style>

<canvas>No support.</canvas>

<script>
  const canvas = document.getElementsByTagName('canvas')[0];
  canvas.width = window.innerWidth;
  canvas.height = 200;
  const c = canvas.getContext('2d');

  let cellPool = {
    cells: [],
    visible: { start: 0, end: 0 }
  };

  // cell state
  let cell = {
    size: 50,
    x: 50,
    y: 100,
    angle: 0,
    animFrame: 0
  };

  // cell animation frame parameters for 60fps
  let cellFrameOpts = {
    animFramesTotal: 2 * 60,  // seconds * 60fps
    velocityX: 0,
    velocityY: 0
  };

  // frame-duration cache
  let fc = {
    rdX: null, rdY: null, ctlX: null, ctlY: null, animPercent: null
  };

  let renderCellPath = function() {
    c.beginPath();
    c.moveTo(0, -fc.rdY);
    c.bezierCurveTo(fc.ctlX, -fc.rdY, fc.rdX, -fc.ctlY, fc.rdX, 0);
    c.bezierCurveTo(fc.rdX, fc.ctlY, fc.ctlX, fc.rdY, 0, fc.rdY);
    c.bezierCurveTo(-fc.ctlX, fc.rdY, -fc.rdX, fc.ctlY, -fc.rdX, 0);
    c.bezierCurveTo(-fc.rdX, -fc.ctlY, -fc.ctlX, -fc.rdY, 0, -fc.rdY);
  };

  let renderCellFrame = function(cell) {
    // compute animation state
    if (cell.animFrame === cellFrameOpts.animFramesTotal) cell.animFrame = -1;
    cell.animFrame += 1;
    fc.animPercent = cell.animFrame / cellFrameOpts.animFramesTotal * 100;

    // enter render context
    c.save();

    // compute outside path
    fc.rdX = cell.size / 2;
    fc.rdY = fc.rdX * (.2 + .8 * Math.abs(fc.animPercent - 50) / 50);
    fc.ctlX = 4 / 3 * Math.tan(Math.PI / 8) * fc.rdX; // horiz bezier handle
    fc.ctlY = fc.ctlX * fc.rdY / fc.rdX;              // verti bezier handle

    // render outside path
    c.translate(cell.x, cell.y);
    renderCellPath();
    c.fillStyle = 'rgb(242, 116, 116)';
    c.fill();

    // position inside path while outside rdY available
    c.translate(0, fc.animPercent < 50 ? fc.rdY : -fc.rdY);

    // compute inside path
    fc.rdX /= 2;
    fc.rdY = fc.rdX * Math.abs(fc.animPercent - 50) / 50;
    fc.ctlX /= 2;
    fc.ctlY = fc.ctlX * fc.rdY / fc.rdX;

    // render inside path
    if (fc.rdY !== 0) {
      c.translate(0, fc.animPercent < 50 ? -fc.rdY * 2 : fc.rdY * 2);
      renderCellPath();
      c.fillStyle = 'rgb(210, 58, 58)';
      c.fill();
    }

    // exit render context
    c.restore();
  };

  let renderCells = function() {
    c.fillStyle = 'rgb(255, 255, 255)';
    c.fillRect(0, 0, canvas.width, canvas.height);
    renderCellFrame(cell);
  };

  let raf = function() { renderCells(); window.requestAnimationFrame(raf); };
  raf();
</script>
