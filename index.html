<!doctype html>
<title>Fabian Popa</title>
<meta charset="utf-8">
<meta name="description" content="Technology, biology, and other adventures.">
<meta name="viewport" content="initial-scale=1">

<script>
  // JS available, hide page elements before DOM to control the reveal
  window.site = {};
  window.site.hideAll = document.createElement('style');
  window.site.hideAll.innerHTML = 'body > * { display: none; }';
  document.head.appendChild(window.site.hideAll);
</script>

<style id="loadingstyle">
  #loading {
    display: block;
    position: absolute;
    top: 30%;
    left: 50%;
    transform: translateX(-50%);
    margin: 0 auto;
    width: 12px;
    height: 12px;
    border-radius: 50%;
    background-color: #F27474;
    opacity: 0;
    animation: 1.8s ease-in-out pulse;
  }

  @keyframes pulse { 0% { opacity: 0 } 50% { opacity: 1 } 100% { opacity: 0 } }
</style>

<div id="introduction">
  <h1>Fabian Popa</h1>
  <p>Technology, biology, and other adventures.</p>
  <ul>
    <li><a href="https://github.com/fabpopa">GitHub</a></li>
    <li><a href="https://twitter.com/fabpopa">Twitter</a></li>
    <li><a href="résumé.pdf">Résumé</a></li>
  </ul>
</div>

<div id="nofeatures">
  <p>There is more to this website, but it will not display well in your
  current browser.</p>
  <p><a href="http://whatbrowser.org">Please update to a newer browser</a></p>
  <p>Thank you for stopping by ☺</p>
</div>

<script>
  (function() {
    // ES5 startup
    var js = function() {
      var featuresOk = (function() {
        try {
          new Function('(a = 0) => a');
          return !!document.querySelectorAll &&
            !!window.requestAnimationFrame &&
            !!window.performance.now &&
            (new XMLHttpRequest()).onload !== undefined &&
            document.body.style.flexBasis !== undefined &&
            !!MutationObserver;
        } catch (e) { return false; }
      })();

      var start = function() {
        // features available, remove nofeatures message
        document.body.removeChild(document.querySelector('#nofeatures'));

        // global object to control loading animation
        window.site.loading = (function() {
          var done, ldr;
          ldr = document.createElement('div');
          ldr.id = 'loading';

          var cleanup = function() {
            [window.site.hideAll, ldr, document.querySelector('#loadingstyle')]
            .forEach(el => {
              if (document.head.contains(el)) document.head.removeChild(el);
              if (document.body.contains(el)) document.body.removeChild(el);
            });
            if (done) done();
          };

          // stops and restarts animation and tries to clean up at end of cycle
          ldr.addEventListener('animationend', function() {
            if (done) cleanup(); // stop animation at end of cycle if done set
            ldr.style.animation = 'none'; // restart animation
            window.setTimeout(function() { ldr.style.animation = ''; });
          });

          return {
            show: function() {
              if (!document.body.contains(ldr)) document.body.appendChild(ldr);
            },
            hide: function(cb) {
              if (typeof cb != 'function') cb = function() {};
              if (document.body.contains(ldr)) { done = cb; return; }
              cleanup();
              cb();
            }
          };
        })();

        // only display loading animation if scripting takes noticeable time
        window.site.raceLoad = window.setTimeout(window.site.loading.show, 500);

        // show the fallback if still loading after long amount of time
        window.setTimeout(window.site.loading.hide, 10000);

        // start scripting
        var el = document.createElement('script');
        el.src = 'script.js';
        document.head.appendChild(el);
      };

      if (featuresOk) { start(); return; }
      document.head.removeChild(window.site.hideAll);
    };

    // wait for DOM
    var state = document.readyState;
    if (state === 'interactive' || state === 'complete') { js(); return; }
    document.addEventListener('readystatechange', function h() {
      document.removeEventListener('readystatechange', h);
      js();
    });
  })();
</script>
